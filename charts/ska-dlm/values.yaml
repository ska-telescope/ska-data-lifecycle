system: dlm

# Global parameters
global:
  ingress:
    enabled: false
  storageClass: nfss1
  development: true

nameOverride: ""
fullnameOverride: ""

# DLM
request:
  component: request
  subsystem: data-lifecycle-management
  image: registry.gitlab.com/ska-telescope/ska-data-lifecycle/ska-data-lifecycle
  version: 0.0.1-dev.c57c837e9
  imagePullPolicy: Always
  replicas: 1

migration:
  component: migration
  subsystem: data-lifecycle-management
  image: registry.gitlab.com/ska-telescope/ska-data-lifecycle/ska-data-lifecycle
  version: 0.0.1-dev.c57c837e9
  imagePullPolicy: Always
  replicas: 1

storage:
  component: storage
  subsystem: data-lifecycle-management
  image: registry.gitlab.com/ska-telescope/ska-data-lifecycle/ska-data-lifecycle
  version: 0.0.1-dev.c57c837e9
  imagePullPolicy: Always
  replicas: 1

ingest:
  component: ingest
  subsystem: data-lifecycle-management
  image: registry.gitlab.com/ska-telescope/ska-data-lifecycle/ska-data-lifecycle
  version: 0.0.1-dev.c57c837e9
  imagePullPolicy: Always
  replicas: 1

# Postgresql DB
postgresql:
  enabled: true
  initialise: false
  nameOverride: ska-dlm-postgresql

  # Custom user/password/db to create, has to match postgrest's config below
  # and primary.initdb authentication
  auth:
    username: ska_dlm_admin
    password: password
    database: ska_dlm

  image:
    debug: true

  primary:
    # matches auth.database
    name: ska_dlm
    persistence:
      enabled: true
    initdb:
      user: ska_dlm_admin
      password: password
      scriptsConfigMap: ska-dlm-postgresql-initdb-scripts
    podLabels:
      component: postgresql
      subsystem: data-lifecycle-management
    networkPolicy:
      enabled: false

postgrest:
  component: postgrest
  subsystem: data-lifecycle-management

  image: postgrest/postgrest
  version: v12.0.2
  imagePullPolicy: Always

  replicas: 1
  db_uri: ""
  db_schema: public
  db_anon_role: ska_dlm_admin
  db_pool: 10
  server_host: '*4'
  secret_is_base64: false
  max_rows: ""
  pre_request: ""
  role_claim_key: '.role'

rclone:
  component: rclone
  subsystem: data-lifecycle-management
  image: rclone/rclone
  version: "1.65"
  imagePullPolicy: Always

  replicas: 1

kubectl:
  image: bitnami/kubectl
  version: 1.28.6
  imagePullPolicy: Always

# Development and Testing Only

gateway:
  enabled: true
  component: gateway
  subsystem: data-lifecycle-management
  image: registry.gitlab.com/ska-telescope/ska-data-lifecycle/ska-data-lifecycle-test-gateway
  version: "0.0.1"
  imagePullPolicy: Always
  replicas: 1

keycloak:
  enabled: true
  image: quay.io/keycloak/keycloak
  version: 25.0.2
  imagePullPolicy: Always
  replicas: 1

pgweb:
  # see https://github.com/ectobit/charts/tree/main/pgweb
  enabled: false
  ingress:
    enabled: false
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /$2
    hosts:
    - paths:
      - path: /pgweb(/|$)(.*)
        pathType: ImplementationSpecific
